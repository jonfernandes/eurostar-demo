<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INC0006900 PAH platform not respecting GZIP headers properly- PAH opens blank</title>
</head>
<body>
    <h1>INC0006900 PAH platform not respecting GZIP headers properly- PAH opens blank</h1>
    <div><div>
	Browser : FireFox/ ALL</div>
<div>
	Sites UK/ ALL</div>
<div>
	 </div>
<div>
	we have been forwarded this comment re GZIP headers that may answer the issue of PAH not opening for some clients ..and results in a blank page?</div>
<div>
	 </div>
<div>
	please read below </div>
<div>
	 </div>
<div>
	I have noticed an issue with the Eurostar website page that provides PDF tickets. Basically, our proxy gets upset at the PDF files your servers sends, and bails. This is due to the fact that your web server sends responses to clients&#39; requests that are not compliant with established web standards (in particular HTTP/1.1).</div>
<div>
	 </div>
<div>
	 </div>
<div>
	 </div>
<div>
	After testing, we realised that the web server insists on compressing the page with gzip encoding, even though the client clearly sends headers advising the server not to. And even when the webserver sends back a plain response, the headers it sends are wrong.</div>
<div>
	 </div>
<div>
	 </div>
<div>
	 </div>
<div>
	Under normal circumstances, a client sending an HTTP request that doesn&#39;t have an &quot;Accept-Encoding&quot; header means that the webserver shouldn&#39;t compress the files. Yet your webserver still does:</div>
<div>
	 </div>
<div>
	 </div>
<div>
	 </div>
<div>
	GET /sbe-ticketing/PAHServlet?pnr=RQMRFV&amp;type=all&amp;firstname=NELE&amp;lastname=VLEESCHOUWERS&amp;lang=en&amp;correlationid=WWW-5280c83391aea&amp;POS=GBZXA HTTP/1.1</div>
<div>
	 </div>
<div>
	Host: pah.eurostar.com</div>
<div>
	 </div>
<div>
	User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:25.0) Gecko/20100101 Firefox/25.0</div>
<div>
	 </div>
<div>
	Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</div>
<div>
	 </div>
<div>
	Accept-Language: en-US,en;q=0.5</div>
<div>
	 </div>
<div>
	Cookie: SESSad785874410b3b6d341774ff85dae4cf=rXzWZJJJdsim-7tU3WgVZ7psa_Nzzx4TcBYV5kXCNAc; qbef=%7B%22cc%22%3A0%2C%22sc%22%3A0%7D; _qubitTracker=1384171551452.931360; _qubitTracker_s=1384171551452.931360; _qst=%5B1%2C0%5D; _qsst=1384171574300; _qPageNum_eurostar_new=1; __utma=106069527.1716420246.1384171552.1384171552.1384171552.1; __utmb=106069527.3.9.1384171588546; __utmc=106069527; __utmz=106069527.1384171552.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)</div>
<div>
	 </div>
<div>
	Connection: keep-alive</div>
<div>
	 </div>
<div>
	 </div>
<div>
	 </div>
<div>
	HTTP/1.1 200 OK</div>
<div>
	 </div>
<div>
	firstname: NELE</div>
<div>
	 </div>
<div>
	User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:25.0) Gecko/20100101 Firefox/25.0</div>
<div>
	 </div>
<div>
	Server: httpVSC</div>
<div>
	 </div>
<div>
	Vary: Accept-Encoding</div>
<div>
	 </div>
<div>
	Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</div>
<div>
	 </div>
<div>
	Content-Type: application/pdf</div>
<div>
	 </div>
<div>
	correlationid: WWW-5280c83391aea</div>
<div>
	 </div>
<div>
	Accept-Language: en-US,en;q=0.5</div>
<div>
	 </div>
<div>
	Content-Encoding: gzip</div>
<div>
	 </div>
<div>
	type: all</div>
<div>
	 </div>
<div>
	PASSWORD: FVSx0HYh</div>
<div>
	 </div>
<div>
	Host: pah.eurostar.com</div>
<div>
	 </div>
<div>
	lang: en</div>
<div>
	 </div>
<div>
	POS: GBZXA</div>
<div>
	 </div>
<div>
	Transfer-Encoding: chunked</div>
<div>
	 </div>
<div>
	USERNAME: GBZXA</div>
<div>
	 </div>
<div>
	X-Cluster-Client-Ip: 185.24.120.6</div>
<div>
	 </div>
<div>
	breadcrumbId: ID-427165-mq1-lon3-eurostar-com-60410-1382575828644-0-8063272</div>
<div>
	 </div>
<div>
	pnr: RQMRFV</div>
<div>
	 </div>
<div>
	lastname: VLEESCHOUWERS</div>
<div>
	 </div>
<div>
	Set-Cookie: NERPRD6TKT=nermerp62tkt; path=/; Secure; HttpOnly</div>
<div>
	 </div>
<div>
	Set-Cookie: TLSID=185241206-368914927; path=/</div>
<div>
	 </div>
<div>
	X-Robots-Tag: none</div>
<div>
	 </div>
<div>
	X-Frame-Options: DENY</div>
<div>
	 </div>
<div>
	Accept-Encoding: gzip</div>
<div>
	 </div>
<div>
	 </div>
<div>
	 </div>
<div>
	8000</div>
<div>
	 </div>
<div>
	^_&lt;8b&gt;^H^</div>
<div>
	 </div>
<div>
	[this is gzip-encoded data]</div>
<div>
	 </div>
<div>
	 </div>
<div>
	 </div>
<div>
	I then thought of setting up our proxy to send &quot;Accept-Encoding: plain;q=0,gzip&quot;. This explicitly tells the webserver not to use gzip compression. This seems to work, except…</div>
<div>
	 </div>
<div>
	 </div>
<div>
	 </div>
<div>
	GET /sbe-ticketing/PAHServlet?pnr=RQMRFV&amp;type=all&amp;firstname=NELE&amp;lastname=VLEESCHOUWERS&amp;lang=en&amp;correlationid=WWW-5280c83391aea&amp;POS=GBZXA HTTP/1.1</div>
<div>
	 </div>
<div>
	Host: pah.eurostar.com</div>
<div>
	 </div>
<div>
	User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:25.0) Gecko/20100101 Firefox/25.0</div>
<div>
	 </div>
<div>
	Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</div>
<div>
	 </div>
<div>
	Accept-Language: en-US,en;q=0.5</div>
<div>
	 </div>
<div>
	Accept-Encoding: plain;q=0,gzip</div>
<div>
	 </div>
<div>
	Cookie: SESSad785874410b3b6d341774ff85dae4cf=rXzWZJJJdsim-7tU3WgVZ7psa_Nzzx4TcBYV5kXCNAc; qbef=%7B%22cc%22%3A0%2C%22sc%22%3A0%7D; _qubitTracker=1384171551452.931360; _qubitTracker_s=1384171551452.931360; _qst=%5B1%2C0%5D; _qsst=1384171574300; _qPageNum_eurostar_new=1; __utma=106069527.1716420246.1384171552.1384171552.1384171552.1; __utmb=106069527.3.9.1384171588546; __utmc=106069527; __utmz=106069527.1384171552.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none)</div>
<div>
	 </div>
<div>
	Connection: keep-alive</div>
<div>
	 </div>
<div>
	 </div>
<div>
	 </div>
<div>
	HTTP/1.1 200 OK</div>
<div>
	 </div>
<div>
	firstname: NELE</div>
<div>
	 </div>
<div>
	Server: httpVSC</div>
<div>
	 </div>
<div>
	User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:25.0) Gecko/20100101 Firefox/25.0</div>
<div>
	 </div>
<div>
	Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</div>
<div>
	 </div>
<div>
	Vary: Accept-Encoding</div>
<div>
	 </div>
<div>
	Content-Type: application/pdf</div>
<div>
	 </div>
<div>
	correlationid: WWW-5280c83391aea</div>
<div>
	 </div>
<div>
	Accept-Language: en-US,en;q=0.5</div>
<div>
	 </div>
<div>
	type: all</div>
<div>
	 </div>
<div>
	PASSWORD: FVSx0HYh</div>
<div>
	 </div>
<div>
	Content-Encoding: gzip</div>
<div>
	 </div>
<div>
	Host: pah.eurostar.com</div>
<div>
	 </div>
<div>
	lang: en</div>
<div>
	 </div>
<div>
	POS: GBZXA</div>
<div>
	 </div>
<div>
	Transfer-Encoding: chunked</div>
<div>
	 </div>
<div>
	USERNAME: GBZXA</div>
<div>
	 </div>
<div>
	X-Cluster-Client-Ip: 185.24.120.6</div>
<div>
	 </div>
<div>
	breadcrumbId: ID-427165-mq1-lon3-eurostar-com-60410-1382575828644-0-7975626</div>
<div>
	 </div>
<div>
	pnr: RQMRFV</div>
<div>
	 </div>
<div>
	lastname: VLEESCHOUWERS</div>
<div>
	 </div>
<div>
	Set-Cookie: NERPRD1TKT=nermagp12tkt; path=/; Secure; HttpOnly</div>
<div>
	 </div>
<div>
	Set-Cookie: TLSID=185241206-578173643; path=/</div>
<div>
	 </div>
<div>
	X-Robots-Tag: none</div>
<div>
	 </div>
<div>
	X-Frame-Options: DENY</div>
<div>
	 </div>
<div>
	Accept-Encoding: gzip</div>
<div>
	 </div>
<div>
	 </div>
<div>
	 </div>
<div>
	8000</div>
<div>
	 </div>
<div>
	^_&lt;8b&gt;^H^@^@^@^@^@^@^C^@Ã</div>
<div>
	 </div>
<div>
	4Ãµ%PDF-1.4</div>
<div>
	 </div>
<div>
	[this is an uncompressed PDF]</div>
<div>
	 </div>
<div>
	 </div>
<div>
	 </div>
<div>
	The file your webserver sends is uncompressed, however it still carries the &quot;Content-Encoding: gzip&quot; header. Our proxy flags this as suspicious behaviour, and drops the connection.</div>
<div>
	 </div>
<div>
	 </div>
<div>
	 </div>
<div>
	I think this behaviour from your web server is the cause of the issues we are having. I believe you should fix your web server because:</div>
<div>
	 </div>
<div>
	1.       Already-compressed data (such as PDF files) should not be re-compressed. The benefit of the additional gzip compression on the PDF file your webserver sends is nil (in this specific case, the PDF is 915KB, the gzipped version is 903KB). And especially for PDFs, HTTP compression should never be used.</div>
<div>
	 </div>
<div>
	2.       The webserver should honour the absence of &quot;Accept-Encoding&quot; and send an uncompressed file. Sending a gzipped response without the client indicating it is ready to accept so is a violation of the HTTP/1.1 specifications. (&quot;If no Accept-Encoding field is present in a request, the server MAY assume that the client will accept any content coding. In this case, if &quot;identity&quot; is one of the available content-codings, then the server SHOULD use the &quot;identity&quot; content-coding, unless it has additional information that a different content-coding is meaningful the client.&quot; – from RFC 2616)</div>
<div>
	 </div>
<div>
	3.       When the server sends out a non-compressed response, it should not add a header saying it is compressed.</div>
<div>
	 </div>
<div>
	 </div>
<div>
	 </div></div>
</body>
</html>